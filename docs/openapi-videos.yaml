openapi: 3.0.3
info:
  title: Video Platform API - Videos
  version: 1.0.0
  license:
    name: MIT
    url: https://opensource.org/licenses/MIT
servers:
  - url: http://localhost:4000/api
security:
  - BearerAuth: []
paths:
  /videos/feed:
    get:
      summary: Get video feed
      operationId: getVideoFeed
      security: []
      parameters:
        - in: query
          name: page
          schema: { type: integer, default: 1 }
        - in: query
          name: limit
          schema: { type: integer, default: 20 }
        - in: query
          name: type
          schema: { type: string, enum: [STANDARD, SHORT] }
      responses:
        '200':
          description: Feed
          content:
            application/json:
              schema: { $ref: './openapi.yaml#/components/schemas/VideoFeedResponse' }
              example:
                success: true
                data: []
                meta:
                  page: 1
                  limit: 20
                  total: 0
                  totalPages: 0
                  hasNextPage: false
                  hasPrevPage: false
        '400':
          $ref: './openapi.yaml#/components/responses/BadRequest'
  /videos/search:
    get:
      summary: Search videos
      operationId: searchVideos
      security: []
      parameters:
        - in: query
          name: q
          required: true
          schema: { type: string }
        - in: query
          name: page
          schema: { type: integer, default: 1 }
        - in: query
          name: limit
          schema: { type: integer, default: 20 }
        - in: query
          name: type
          schema: { type: string, enum: [STANDARD, SHORT] }
        - in: query
          name: duration
          schema: { type: string, enum: [short, medium, long] }
        - in: query
          name: uploadDate
          schema: { type: string, enum: [hour, today, week, month, year] }
        - in: query
          name: sortBy
          schema: { type: string, enum: [relevance, date, views, rating] }
      responses:
        '200':
          description: Search results
          content:
            application/json:
              schema: { $ref: './openapi.yaml#/components/schemas/VideoFeedResponse' }
              example:
                success: true
                data: []
                meta:
                  page: 1
                  limit: 20
                  total: 0
                  totalPages: 0
                  hasNextPage: false
                  hasPrevPage: false
        '400':
          $ref: './openapi.yaml#/components/responses/BadRequest'
  /videos/{id}:
    get:
      summary: Get video by id
      operationId: getVideoById
      security: []
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string }
      responses:
        '200':
          description: Video
          content:
            application/json:
              schema: { $ref: './openapi.yaml#/components/schemas/VideoResponse' }
              example:
                success: true
                data:
                  id: "v_1"
                  title: "Building a Video Platform"
                  description: "Intro to HLS and transcoding."
                  thumbnailUrl: "https://cdn.example/thumb.jpg"
                  duration: 1245
                  views: 156423
                  likes: 8934
                  type: "STANDARD"
                  publishedAt: "2026-02-08T10:00:00Z"
                  channel:
                    id: "c_1"
                    name: "Tech with Sarah"
                    handle: "@sarahjtech"
                    verified: true
                    subscriberCount: 1500000
        '404':
          $ref: './openapi.yaml#/components/responses/NotFound'
    patch:
      summary: Update video
      operationId: updateVideo
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string }
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: './openapi.yaml#/components/schemas/VideoUpdateRequest' }
            example:
              title: "Updated title"
              description: "Updated description"
              isPublic: true
              allowComments: true
      responses:
        '200':
          description: Updated
          content:
            application/json:
              schema: { $ref: './openapi.yaml#/components/schemas/VideoResponse' }
              example:
                success: true
                data:
                  id: "v_1"
                  title: "Updated title"
                  description: "Updated description"
                  thumbnailUrl: "https://cdn.example/thumb.jpg"
                  duration: 1245
                  views: 156423
                  likes: 8934
                  type: "STANDARD"
                  publishedAt: "2026-02-08T10:00:00Z"
                  channel:
                    id: "c_1"
                    name: "Tech with Sarah"
                    handle: "@sarahjtech"
                    verified: true
                    subscriberCount: 1500000
        '401':
          $ref: './openapi.yaml#/components/responses/Unauthorized'
    delete:
      summary: Delete video
      operationId: deleteVideo
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string }
      responses:
        '200':
          description: Deleted
          content:
            application/json:
              schema: { $ref: './openapi.yaml#/components/schemas/ApiResponse' }
              example:
                success: true
                message: "Video deleted"
        '401':
          $ref: './openapi.yaml#/components/responses/Unauthorized'
  /videos/{id}/recommended:
    get:
      summary: Get recommended videos for a video
      operationId: getRecommendedVideos
      security: []
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string }
      responses:
        '200':
          description: Recommendations
          content:
            application/json:
              schema: { $ref: './openapi.yaml#/components/schemas/VideoFeedResponse' }
              example:
                success: true
                data: []
                meta:
                  page: 1
                  limit: 10
                  total: 0
                  totalPages: 0
                  hasNextPage: false
                  hasPrevPage: false
        '404':
          $ref: './openapi.yaml#/components/responses/NotFound'
  /videos/upload:
    post:
      summary: Upload video
      operationId: uploadVideo
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                video:
                  type: string
                  format: binary
                thumbnail:
                  type: string
                  format: binary
                title:
                  type: string
                description:
                  type: string
                isPublic:
                  type: boolean
                allowComments:
                  type: boolean
              required: [video, title]
      responses:
        '200':
          description: Uploaded
          content:
            application/json:
              schema: { $ref: './openapi.yaml#/components/schemas/VideoResponse' }
              example:
                success: true
                data:
                  id: "v_new"
                  title: "New upload"
                  description: "First upload"
                  thumbnailUrl: "https://cdn.example/thumb.jpg"
                  duration: 0
                  views: 0
                  likes: 0
                  type: "STANDARD"
                  publishedAt: null
                  channel:
                    id: "c_1"
                    name: "Tech with Sarah"
                    handle: "@sarahjtech"
                    verified: true
                    subscriberCount: 1500000
        '401':
          $ref: './openapi.yaml#/components/responses/Unauthorized'
  /videos/{id}/like:
    post:
      summary: Like or dislike a video
      operationId: toggleVideoLike
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string }
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: './openapi.yaml#/components/schemas/VideoLikeRequest' }
            example:
              type: "LIKE"
      responses:
        '200':
          description: Updated
          content:
            application/json:
              schema: { $ref: './openapi.yaml#/components/schemas/ApiResponse' }
              example:
                success: true
                message: "Like updated"
        '401':
          $ref: './openapi.yaml#/components/responses/Unauthorized'
  /videos/{id}/like-status:
    get:
      summary: Get like status
      operationId: getVideoLikeStatus
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string }
      responses:
        '200':
          description: Status
          content:
            application/json:
              schema: { $ref: './openapi.yaml#/components/schemas/LikeStatusResponse' }
              example:
                success: true
                data:
                  liked: true
                  disliked: false
        '401':
          $ref: './openapi.yaml#/components/responses/Unauthorized'
  /videos/{id}/view:
    post:
      summary: Increment view count
      operationId: incrementViewCount
      security: []
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string }
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema: { $ref: './openapi.yaml#/components/schemas/ApiResponse' }
              example:
                success: true
        '400':
          $ref: './openapi.yaml#/components/responses/BadRequest'
  /videos/{id}/watch:
    post:
      summary: Record watch history
      operationId: recordWatchHistory
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string }
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: './openapi.yaml#/components/schemas/WatchRequest' }
            example:
              watchDuration: 312
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema: { $ref: './openapi.yaml#/components/schemas/ApiResponse' }
              example:
                success: true
        '401':
          $ref: './openapi.yaml#/components/responses/Unauthorized'
  /videos/{id}/transcode-complete:
    post:
      summary: Webhook for transcode completion
      operationId: transcodeComplete
      security: []
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string }
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: './openapi.yaml#/components/schemas/TranscodeCompleteRequest' }
            example:
              status: "READY"
              hlsPath: "/uploads/processed/v_1/master.m3u8"
              thumbnailUrl: "https://cdn.example/thumb.jpg"
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema: { $ref: './openapi.yaml#/components/schemas/ApiResponse' }
              example:
                success: true
        '400':
          $ref: './openapi.yaml#/components/responses/BadRequest'
components:
  securitySchemes:
    BearerAuth:
      $ref: './openapi.yaml#/components/securitySchemes/BearerAuth'
  schemas:
    ApiResponse:
      $ref: './openapi.yaml#/components/schemas/ApiResponse'
    VideoResponse:
      $ref: './openapi.yaml#/components/schemas/VideoResponse'
    VideoFeedResponse:
      $ref: './openapi.yaml#/components/schemas/VideoFeedResponse'
    VideoUpdateRequest:
      $ref: './openapi.yaml#/components/schemas/VideoUpdateRequest'
    VideoLikeRequest:
      $ref: './openapi.yaml#/components/schemas/VideoLikeRequest'
    LikeStatusResponse:
      $ref: './openapi.yaml#/components/schemas/LikeStatusResponse'
    WatchRequest:
      $ref: './openapi.yaml#/components/schemas/WatchRequest'
    TranscodeCompleteRequest:
      $ref: './openapi.yaml#/components/schemas/TranscodeCompleteRequest'
